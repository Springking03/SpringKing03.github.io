<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Game 1 ‚Äì Tr·∫Øc nghi·ªám</title>

<!-- Preload t√†i nguy√™n cho m∆∞·ª£t -->
<link rel="preload" as="video" href="intro.mp4" type="video/mp4">
<link rel="preload" as="video" href="reaction.mp4" type="video/mp4">
<link rel="preload" as="image" href="banh_chung.jpg">
<link rel="preload" as="image" href="banh_ran.jpg">
<link rel="preload" as="image" href="banh_gai.jpg">
<link rel="preload" as="image" href="tiramisu.jpg">

<style>
  /* ===== Font Vinamilk ===== */
  @font-face{
    font-family: "Vinamilk";
    src: url("vinamilk.woff2") format("woff2"),
         url("vinamilk.woff")  format("woff");
    font-display: swap;
  }

  :root{
    --bg1:#0f0c29; --bg2:#302b63; --bg3:#24243e;
    --rose:#ff5fa2; --soft:#ffd1dc; --ok:#29cc7a; --bad:#ff5b6b;
    --glass:rgba(255,255,255,.08); --border:rgba(255,255,255,.14);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:#fff;
    font-family:"Vinamilk", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background:
      radial-gradient(1000px 700px at 50% 10%, rgba(255,255,255,.08), transparent 60%),
      linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
    display:flex; flex-direction:column; min-height:100%;
  }

  header{
    text-align:center; padding:14px 10px; background:rgba(255,255,255,.06);
    border-bottom:1px solid rgba(255,255,255,.12);
  }
  header h1{
    margin:0; font-weight:900; font-size:clamp(18px,5.4vw,28px);
    background:linear-gradient(90deg, #fff, var(--rose), var(--soft), #fff);
    -webkit-background-clip:text; background-clip:text; color:transparent;
  }

  main{ flex:1; display:grid; place-items:center; padding:16px; }

  /* Khung video m·ªü m√†n c√≥ vi·ªÅn ƒë·∫πp */
  .video-frame{
    width:min(1000px, 96vw); aspect-ratio:16/9; position:relative;
    border-radius:22px; padding:3px; /* ƒë·ªÉ t·∫°o vi·ªÅn */
    background:
      linear-gradient(135deg, #ffffff66, #ffffff10) padding-box,
      linear-gradient(135deg, #89f7fe, #66a6ff, #ff9ec4, #ffd1dc) border-box;
    -webkit-mask:
      linear-gradient(#000 0 0) padding-box, 
      linear-gradient(#000 0 0);
    -webkit-mask-composite: xor; mask-composite: exclude;
    box-shadow: 0 16px 48px rgba(0,0,0,.45);
  }
  .video-frame video{
    width:100%; height:100%; object-fit:cover; display:block;
    border-radius:18px; background:#000;
  }
  .hidden{ display:none !important }

  /* C√¢u h·ªèi + ƒë√°p √°n */
  .card{
    width:min(1100px, 96vw);
    background:var(--glass); border:1px solid var(--border);
    border-radius:24px; padding:clamp(14px,4.5vw,26px);
    backdrop-filter: blur(10px);
    box-shadow:0 16px 46px rgba(0,0,0,.4), inset 0 0 0 1px rgba(255,255,255,.06);
    animation: pop .5s ease;
  }
  @keyframes pop{ from{opacity:0; transform:translateY(8px) scale(.98)} to{opacity:1; transform:none} }

  .q-title{
    margin:0 0 12px; font-weight:900; font-size:clamp(16px,4.8vw,22px);
  }
  .options{
    display:grid; gap:12px;
    grid-template-columns: repeat(2, minmax(0,1fr));
  }
  @media (max-width:640px){ .options{ grid-template-columns: 1fr } }

  .opt{
    display:flex; gap:12px; align-items:center;
    background:rgba(255,255,255,.10);
    border:1px solid var(--border);
    border-radius:16px; padding:10px; cursor:pointer;
    transition: transform .08s ease, filter .12s ease, box-shadow .12s ease;
  }
  .opt:hover{ filter: brightness(1.03) }
  .opt:active{ transform:scale(.98) }
  .opt[disabled]{ opacity:.6; cursor:not-allowed }

  .thumb{
    width:84px; height:72px; flex:0 0 auto; overflow:hidden; border-radius:12px;
    background:#111; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08);
  }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block }
  .label{ font-weight:900; letter-spacing:.2px }

  /* Overlay th√¥ng b√°o sai */
  .overlay{
    position:fixed; inset:0; display:none; place-items:center; z-index:20;
    background:rgba(0,0,0,.85); text-align:center; padding:18px;
  }
  .overlay.show{ display:grid }
  .toast{
    background:#000; border:1px solid rgba(255,255,255,.12); color:#fff;
    border-radius:16px; padding:16px 18px; font-weight:900;
    width:min(520px, 90vw); box-shadow:0 12px 40px rgba(0,0,0,.6);
  }
  .toast.bad{ color:var(--bad) }
  .toast.ok { color:var(--ok) }

  /* Animation: c√¢u tr·∫£ l·ªùi ƒë√∫ng bay v√†o gi·ªØa v√† xoay */
  .fly-layer{
    position:fixed; inset:0; pointer-events:none; z-index:30; display:none;
  }
  .fly-layer.show{ display:block }
  .fly-item{
    position:fixed; will-change: transform, opacity;
    border-radius:16px; overflow:hidden; box-shadow:0 16px 46px rgba(0,0,0,.5);
    transform-origin:center center;
    animation: spinToCenter 1.1s ease forwards;
  }
  @keyframes spinToCenter{
    0%{ transform: var(--from-transform); opacity:1 }
    60%{ transform: translate(var(--cx), var(--cy)) scale(0.9) rotate(540deg); }
    100%{ transform: translate(var(--cx), var(--cy)) scale(1.05) rotate(720deg); opacity:1 }
  }

  /* B√πng n·ªü */
  .burst{
    position:fixed; inset:0; display:none; place-items:center; z-index:35;
  }
  .burst.show{ display:grid }
  .ring{
    width:40vmin; height:40vmin; border-radius:50%;
    background: radial-gradient(circle, rgba(255,255,255,.9), rgba(255,255,255,.05) 60%, transparent 70%);
    animation: burstOut .6s ease forwards;
  }
  @keyframes burstOut{
    from{ transform: scale(.2); opacity:.8 }
    to  { transform: scale(2.2); opacity:0 }
  }

  /* Video c·∫£m x√∫c sau khi ƒë√∫ng */
  .reaction{
    position:fixed; inset:0; background:#000; z-index:40; display:none;
  }
  .reaction.show{ display:block }
  .reaction video{ width:100vw; height:100vh; object-fit:cover; display:block; }

</style>
</head>
<body>

<header>
  <h1>üéÆ Game 1</h1>
</header>

<main>
  <!-- Video m·ªü m√†n -->
  <div class="video-section" id="introWrap">
    <div class="video-frame">
      <video id="introVideo" src="intro.mp4" playsinline muted autoplay></video>
    </div>
  </div>

  <!-- C√¢u h·ªèi + ƒë√°p √°n (·∫©n cho ƒë·∫øn khi video xong) -->
  <div class="card hidden" id="quizCard">
    <h2 class="q-title">Ch·ªçn m√≥n ƒë√∫ng l√† Tiramisu:</h2>
    <div class="options" id="options">
      <button class="opt" data-key="A">
        <div class="thumb"><img src="banh_chung.jpg" alt="B√°nh ch∆∞ng"></div>
        <div class="label"><strong>A.</strong> B√°nh ch∆∞ng</div>
      </button>

      <button class="opt" data-key="B">
        <div class="thumb"><img src="banh_ran.jpg" alt="B√°nh r√°n"></div>
        <div class="label"><strong>B.</strong> B√°nh r√°n</div>
      </button>

      <button class="opt" data-key="C">
        <div class="thumb"><img src="banh_gai.jpg" alt="B√°nh gai"></div>
        <div class="label"><strong>C.</strong> B√°nh gai</div>
      </button>

      <button class="opt" data-key="D" id="optD">
        <div class="thumb"><img src="tiramisu.jpg" alt="Tiramisu"></div>
        <div class="label"><strong>D.</strong> Tiramisu</div>
      </button>
    </div>
  </div>
</main>

<!-- Overlay b√°o sai -->
<div class="overlay" id="wrongOverlay">
  <div class="toast bad">Sai r·ªìi, l√†m l·∫°i nha üíó</div>
</div>

<!-- L·ªõp bay xoay khi ƒë√∫ng -->
<div class="fly-layer" id="flyLayer"></div>

<!-- Hi·ªáu ·ª©ng b√πng n·ªü -->
<div class="burst" id="burst"><div class="ring"></div></div>

<!-- Video c·∫£m x√∫c -->
<div class="reaction" id="reaction">
  <video id="reactionVideo" src="game1.mp4" playsinline muted autoplay></video>
</div>

<script>
  const CORRECT_KEY = 'D';
  const NEXT_PAGE   = 'game2.html';

  const introWrap   = document.getElementById('introWrap');
  const introVideo  = document.getElementById('introVideo');
  const quizCard    = document.getElementById('quizCard');
  const optionsBox  = document.getElementById('options');
  const wrongOverlay= document.getElementById('wrongOverlay');
  const flyLayer    = document.getElementById('flyLayer');
  const burst       = document.getElementById('burst');
  const reaction    = document.getElementById('reaction');
  const reactionVid = document.getElementById('reactionVideo');

  // Khi video m·ªü m√†n k·∫øt th√∫c -> hi·ªán c√¢u h·ªèi
  introVideo.addEventListener('ended', () => {
    introWrap.classList.add('hidden');
    quizCard.classList.remove('hidden');
  });

  // Ph√≤ng tr∆∞·ªùng h·ª£p autoplay b·ªã ch·∫∑n => sau 0.5s v·∫´n ch∆∞a ch·∫°y th√¨ cho hi·ªán lu√¥n c√¢u h·ªèi
  setTimeout(() => {
    if (introVideo.currentTime < 0.1) {
      introWrap.classList.add('hidden');
      quizCard.classList.remove('hidden');
    }
  }, 800);

  // Ch·ªçn ƒë√°p √°n
  const opts = Array.from(document.querySelectorAll('.opt'));
  function disableAll(){ opts.forEach(o=>o.disabled=true); }
  function enableAll(){ opts.forEach(o=>o.disabled=false); }

  opts.forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const key = btn.getAttribute('data-key');
      if(key === CORRECT_KEY){
        disableAll();
        correctAnimation(btn);
      } else {
        disableAll();
        wrongOverlay.classList.add('show');
        setTimeout(()=>{ location.reload(); }, 1200);
      }
    });
  });

  // T·∫°o hi·ªáu ·ª©ng xoay-bay c·ªßa ƒë√°p √°n ƒë√∫ng v√†o gi·ªØa
  function correctAnimation(sourceBtn){
    // L·∫•y v·ªã tr√≠ hi·ªán t·∫°i
    const rect = sourceBtn.getBoundingClientRect();
    const clone = sourceBtn.cloneNode(true);
    clone.classList.remove('opt');
    clone.style.width  = rect.width+'px';
    clone.style.height = rect.height+'px';
    clone.style.left   = rect.left+'px';
    clone.style.top    = rect.top+'px';
    clone.className = 'fly-item';

    // T√≠nh vector ƒë·ªÉ bay v√†o gi·ªØa
    const cx = window.innerWidth/2 - (rect.left + rect.width/2);
    const cy = window.innerHeight/2 - (rect.top  + rect.height/2);
    clone.style.setProperty('--from-transform', `translate(0px,0px) scale(1) rotate(0deg)`);
    clone.style.setProperty('--cx', `${cx}px`);
    clone.style.setProperty('--cy', `${cy}px`);

    flyLayer.innerHTML = '';
    flyLayer.appendChild(clone);
    flyLayer.classList.add('show');

    // Sau khi bay xong -> hi·ªáu ·ª©ng "b√πng n·ªü" + video reaction
    setTimeout(()=>{
      burst.classList.add('show');
      setTimeout(()=>{
        // Hi·ªán video reaction (auto ch·∫°y)
        reaction.classList.add('show');
        // C·ªë g·∫Øng b·∫≠t √¢m thanh (n·∫øu tr√¨nh duy·ªát cho)
        reactionVid.muted = false;
        reactionVid.play().catch(()=>{
          reactionVid.muted = true;
          reactionVid.play().catch(()=>{ /* ignore */ });
        });
      }, 300); // tr·ªÖ nh·∫π sau burst
    }, 1150);

    // H·∫øt video reaction -> sang game2
    reactionVid.addEventListener('ended', ()=>{
      window.location.href = NEXT_PAGE;
    });
  }
</script>
</body>
</html>
